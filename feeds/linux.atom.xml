<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Opdev.cn - Linux</title><link href="http://www.opdev.cn/" rel="alternate"></link><link href="http://www.opdev.cn/feeds/linux.atom.xml" rel="self"></link><id>http://www.opdev.cn/</id><updated>2015-08-12T12:30:00+08:00</updated><entry><title>nginx+uwsgi部署</title><link href="http://www.opdev.cn/linux/uwsgi-nginx.html" rel="alternate"></link><published>2015-08-12T12:30:00+08:00</published><updated>2015-08-12T12:30:00+08:00</updated><author><name>zheng</name></author><id>tag:www.opdev.cn,2015-08-12:/linux/uwsgi-nginx.html</id><summary type="html">&lt;h4&gt;1. 安装必要的开发包&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;#  yum install python-devel libxml2-devel python-setuptools zlib-devel wget pcre-devel gcc make&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;2. 安装nginx&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# useradd www&lt;/span&gt;
&lt;span class="code-line"&gt;# wget http://nginx.org …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h4&gt;1. 安装必要的开发包&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;#  yum install python-devel libxml2-devel python-setuptools zlib-devel wget pcre-devel gcc make&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;2. 安装nginx&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# useradd www&lt;/span&gt;
&lt;span class="code-line"&gt;# wget http://nginx.org/download/nginx-1.6.1.tar.gz&lt;/span&gt;
&lt;span class="code-line"&gt;#  ./configure --user=www --group=www \&lt;/span&gt;
&lt;span class="code-line"&gt;--prefix=/usr/local/nginx \&lt;/span&gt;
&lt;span class="code-line"&gt;--with-http_stub_status_module \&lt;/span&gt;
&lt;span class="code-line"&gt;--with-http_gzip_static_module&lt;/span&gt;
&lt;span class="code-line"&gt;//此处在本环节只需指定一个路径&lt;/span&gt;
&lt;span class="code-line"&gt;# make &amp;amp;&amp;amp; make install&lt;/span&gt;
&lt;span class="code-line"&gt;# /usr/local/nginx/sbin/nginx      //启Nginx&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;3.安装uwsgi&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# wget http://projects.unbit.it/downloads/uwsgi-2.0.6.tar.gz&lt;/span&gt;
&lt;span class="code-line"&gt;# tar -zxvf uwsgi-2.6.tar.gz &lt;/span&gt;
&lt;span class="code-line"&gt;# cd uwsgi-2.6.tar.gz &lt;/span&gt;
&lt;span class="code-line"&gt;# python setup.py build &lt;/span&gt;
&lt;span class="code-line"&gt;# make &lt;/span&gt;
&lt;span class="code-line"&gt;# mv uwsgi /usr/bin/           //将编译好的文件移动到此处&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;4.测试uwsgi&lt;/h4&gt;
&lt;p&gt;在你的机器上写一个test.py&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;def application(env, start_response):&lt;/span&gt;
&lt;span class="code-line"&gt;        start_response(&amp;#39;200 OK&amp;#39;, [(&amp;#39;Content-Type&amp;#39;,&amp;#39;text/html&amp;#39;)])&lt;/span&gt;
&lt;span class="code-line"&gt;        return &amp;quot;Hello World&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然后执行shell命令：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# uwsgi --http :9000 --wsgi-file test.py    #注意--http :9000之间有空格&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;访问网页：&lt;/p&gt;
&lt;p&gt;http://127.0.0.1:9001/&lt;/p&gt;
&lt;p&gt;看在网页上是否有Hello World&lt;/p&gt;
&lt;h4&gt;5.配置nginx&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;vim&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;nginx&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;conf&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;nginx&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;conf&lt;/span&gt; &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nt"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="err"&gt;listen&lt;/span&gt; &lt;span class="err"&gt;80&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="err"&gt;server_name&lt;/span&gt; &lt;span class="err"&gt;localhost&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="err"&gt;#charset&lt;/span&gt; &lt;span class="err"&gt;koi8-r&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="err"&gt;access_log&lt;/span&gt; &lt;span class="err"&gt;logs/access.log&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="err"&gt;error_log&lt;/span&gt; &lt;span class="err"&gt;logs/error.log&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="err"&gt;location&lt;/span&gt; &lt;span class="err"&gt;/&lt;/span&gt; &lt;span class="err"&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="err"&gt;uwsgi_pass&lt;/span&gt; &lt;span class="err"&gt;127.0.0.1:9001&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="err"&gt;include&lt;/span&gt; &lt;span class="err"&gt;uwsgi_params&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="p"&gt;#&lt;/span&gt;&lt;span class="nn"&gt;error_page&lt;/span&gt; &lt;span class="nt"&gt;404&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;404&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;html&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="nt"&gt;redirect&lt;/span&gt; &lt;span class="nt"&gt;server&lt;/span&gt; &lt;span class="nt"&gt;error&lt;/span&gt; &lt;span class="nt"&gt;pages&lt;/span&gt; &lt;span class="nt"&gt;to&lt;/span&gt; &lt;span class="nt"&gt;the&lt;/span&gt; &lt;span class="nt"&gt;static&lt;/span&gt; &lt;span class="nt"&gt;page&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;50x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;html&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="err"&gt;#&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nt"&gt;error_page&lt;/span&gt; &lt;span class="nt"&gt;500&lt;/span&gt; &lt;span class="nt"&gt;502&lt;/span&gt; &lt;span class="nt"&gt;503&lt;/span&gt; &lt;span class="nt"&gt;504&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;50x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;html&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nt"&gt;location&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;50x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;html&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="err"&gt;root&lt;/span&gt; &lt;span class="err"&gt;html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nt"&gt;location&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;static&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="err"&gt;alias&lt;/span&gt; &lt;span class="err"&gt;/data/www/django/mysite/aceadmin/static/&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="err"&gt;index&lt;/span&gt; &lt;span class="err"&gt;index.html&lt;/span&gt; &lt;span class="err"&gt;index.htm&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nt"&gt;location&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;media&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="err"&gt;alias&lt;/span&gt; &lt;span class="err"&gt;/data/www/django/mysite/aceadmin/media/&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="err"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;6.配置django&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;NOTE：请保证你的django项目是正常使用的。可以使用&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;python manage.py runserver 0.0.0.0:8002&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;来测试一下你的django项目是否能正常跑起来。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# cat django_wsgi.py&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#!/usr/bin/env python&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# coding: utf-8&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# 将系统的编码设置为UTF8&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#reload(sys)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#sys.setdefaultencoding(&amp;#39;utf8&amp;#39;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#注意：&amp;quot;mysite.settings&amp;quot; 和项目文件夹对应。&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;environ&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setdefault&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;DJANGO_SETTINGS_MODULE&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;myblog.settings&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.core.wsgi&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;get_wsgi_application&lt;/span&gt; &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;application&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_wsgi_application&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;连接&lt;/span&gt;&lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="err"&gt;和&lt;/span&gt;&lt;span class="n"&gt;uwsgi&lt;/span&gt;&lt;span class="err"&gt;，实现简单的&lt;/span&gt;&lt;span class="n"&gt;WEB&lt;/span&gt;&lt;span class="err"&gt;服务器。&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然后，就可以执行以下命令：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# uwsgi --http :9001 --chdir /data/www/django/mysite --module django_wsgi&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这样，你就可以在浏览器中访问你的Django程序了。所有的请求都是经过uwsgi传递给Django程序的。&lt;/p&gt;
&lt;h4&gt;7.配置uWSGI&lt;/h4&gt;
&lt;p&gt;新建一个XML文件：&lt;/p&gt;
&lt;p&gt;vim uwsgi.xml，将它放在 mysite 目录下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;uwsgi&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nt"&gt;&amp;lt;socket&amp;gt;&lt;/span&gt;127.0.0.1:9001&lt;span class="nt"&gt;&amp;lt;/socket&amp;gt;&lt;/span&gt; &lt;span class="c"&gt;&amp;lt;!-- 和nginx中定义的要一致 --&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nt"&gt;&amp;lt;chdir&amp;gt;&lt;/span&gt;/data/django/myblog&lt;span class="nt"&gt;&amp;lt;/chdir&amp;gt;&lt;/span&gt;      &lt;span class="c"&gt;&amp;lt;!-- 你django的项目目录 --&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nt"&gt;&amp;lt;module&amp;gt;&lt;/span&gt;django_wsgi&lt;span class="nt"&gt;&amp;lt;/module&amp;gt;&lt;/span&gt; &lt;span class="c"&gt;&amp;lt;!-- 名称为刚才上面定义的py文件名 --&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nt"&gt;&amp;lt;processes&amp;gt;&lt;/span&gt;4&lt;span class="nt"&gt;&amp;lt;/processes&amp;gt;&lt;/span&gt; &lt;span class="c"&gt;&amp;lt;!-- 进程数 --&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nt"&gt;&amp;lt;daemonize&amp;gt;&lt;/span&gt;/data/django/myblog/log/uwsgi.log&lt;span class="nt"&gt;&amp;lt;/daemonize&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nt"&gt;&amp;lt;/uwsgi&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在上面的配置中，我们使用 uwsgi.log 来记录日志，开启4个进程来处理请求。&lt;/p&gt;
&lt;p&gt;这样，我们就配置好uWSGI了。&lt;/p&gt;
&lt;p&gt;启动uWSGI服务器&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# cd/data/www/django/mysite&lt;/span&gt;
&lt;span class="code-line"&gt;# uwsgi -x uwsgi.xml&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在上面的设置后，可以让Nginx来处理静态文件(/static/ 和 /media/ ）。非静态文件请求Nginx会发给 socket 9001，然后让uWSGI来进行处理。&lt;/p&gt;
&lt;h4&gt;8.其他设置&lt;/h4&gt;
&lt;p&gt;a.关闭django调试模式
DEBUG = False&lt;/p&gt;
&lt;p&gt;b.复制admin文件样式
1. 修改settings.py中STATIC_ROOT为你的static静态文件的物理路径&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;复制静态文件&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# python manage.py collectstatic&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ol&gt;
&lt;li&gt;修改Nginx配置&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;location /static {&lt;/span&gt;
&lt;span class="code-line"&gt;      root /home/user/www;&lt;/span&gt;
&lt;span class="code-line"&gt;  }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;完成上面三步后，重新加载相应设置：&lt;/p&gt;
&lt;p&gt;重启uwsgi和nginx&lt;/p&gt;</content><category term="django"></category><category term="Python"></category><category term="nginx"></category></entry><entry><title>Centos vps安装VPN</title><link href="http://www.opdev.cn/linux/centos-vpn.html" rel="alternate"></link><published>2015-04-20T14:37:19+08:00</published><updated>2015-04-20T14:37:19+08:00</updated><author><name>zheng</name></author><id>tag:www.opdev.cn,2015-04-20:/linux/centos-vpn.html</id><summary type="html">&lt;h4&gt;一、首先检查你VPS的PPP和TUN有没有启用：&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;cat /dev/ppp   &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;cat /dev/net/tun&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;显示结果为：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;cat: /dev/ppp: No such device or address&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;cat: /dev …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h4&gt;一、首先检查你VPS的PPP和TUN有没有启用：&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;cat /dev/ppp   &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;cat /dev/net/tun&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;显示结果为：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;cat: /dev/ppp: No such device or address&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;cat: /dev/net/tun: File descriptor in bad state&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;表明通过，上述两条只要有一个没通过都不行。如果没有启用，你可以给VPS提供商Submit 一个 Ticket请求开通：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Hello   &lt;/p&gt;
&lt;p&gt;Could you enabled TUN-TAP for me? I want run pptp-vpn on my VPS.   &lt;/p&gt;
&lt;p&gt;Thank you.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;确认 PPP 和 TUN 启用后，开始安装 ppp 和 iptables：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;yum install -y ppp iptables&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;二、安装pptp：&lt;/h4&gt;
&lt;h4&gt;（适用32位系统）&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;rpm -ivh http://acelnmp.googlecode.com/files/pptpd-1.3.3-1.rhel4.1.i386.rpm &lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;（适用64位系统）&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;rpm -ivh http://acelnmp.googlecode.com/files/pptpd-1.3.3-1.rhel4.x86_64.rpm  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;三、配置pptp，编辑/etc/pptpd.conf文件：&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;vim /etc/pptpd.conf&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;把下面字段前面的#去掉：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;localip 192.168.0.1   &lt;/span&gt;
&lt;span class="code-line"&gt;remoteip 192.168.0.234-238,192.168.0.245&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;四、编辑/etc/ppp/options.pptpd 文件：&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;vim /etc/ppp/options.pptpd  &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;去掉ms-dns前面的#，并使用Google的DNS服务器，修改成如下字段：&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;ms-dns 8.8.8.8   &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;ms-dns 8.8.4.4&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;五、设置VPN账号密码，编辑/etc/ppp/chap-secrets这个文件：&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;vim /etc/ppp/chap-secrets&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;六、修改内核设置，使其支持转发，编辑 /etc/sysctl.conf 文件：&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;vim /etc/sysctl.conf  &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;将“net.ipv4.ip_forward”的值改为1，同时在“net.ipv4.tcp_syncookies = 1”前面加#&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;七、使 sysctl.conf 配置文件生效并添加 iptables 转发规则：&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;sysctl -p &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -j SNAT --to-source ***.***.***.*** (***.***.***.***为你VPS的公网IP地址)   &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;iptables -A POSTROUTING -t nat -s 192.168.0.0/24 -o eth0 -j MASQUERADE&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 1723 -j ACCEPT #注：这条命令尽量放在防火墙列表前面几条不然可能会阻止  &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;保存iptables转发规则：&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/etc/init.d/iptables save  &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;重启 iptables：&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/etc/init.d/iptables restart  &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;重启pptp服务：&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/etc/init.d/pptpd restart  &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;设置开机自动运行pptp服务：&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;chkconfig pptpd on  &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;设置开机自动运行iptables服务：&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;chkconfig iptables on  &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;到此安装配置结束了。&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="vpn"></category><category term="pptp"></category></entry><entry><title>redis3.0.2 主从搭建</title><link href="http://www.opdev.cn/linux/nosql-redis.html" rel="alternate"></link><published>2014-06-18T19:03:57+08:00</published><updated>2014-06-18T19:03:57+08:00</updated><author><name>zheng</name></author><id>tag:www.opdev.cn,2014-06-18:/linux/nosql-redis.html</id><summary type="html">&lt;h4&gt;环境介绍&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;os： centos 6.4 x64位系统 &lt;/li&gt;
&lt;li&gt;master: 192.168.1.83&lt;/li&gt;
&lt;li&gt;slave: 192.168.1.84&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;两台机器安装redis&lt;/h2&gt;
&lt;h4&gt;安装redis组件tcl&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# yum install …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h4&gt;环境介绍&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;os： centos 6.4 x64位系统 &lt;/li&gt;
&lt;li&gt;master: 192.168.1.83&lt;/li&gt;
&lt;li&gt;slave: 192.168.1.84&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;两台机器安装redis&lt;/h2&gt;
&lt;h4&gt;安装redis组件tcl&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# yum install tcl-devel.x86_64 tcl.x86_64 gcc&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;安装redis&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# tar zxvf redis-3.0.2.tar.gz&lt;/span&gt;
&lt;span class="code-line"&gt;# make PREFIX=/usr/local/redis install&lt;/span&gt;
&lt;span class="code-line"&gt;# make MALLOC=libc  #若报错执行&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;生成配置&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# /root/soft/redis-3.0.2/utils/install_server.sh&lt;/span&gt;
&lt;span class="code-line"&gt;# vim /etc/redis/6379.conf # 修改&lt;/span&gt;
&lt;span class="code-line"&gt;daemonize yestimeout 500&lt;/span&gt;
&lt;span class="code-line"&gt;logfile /data/redis/6379/log/redis_6379.log&lt;/span&gt;
&lt;span class="code-line"&gt;dir /data/redis/6379/data&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;创建目录&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# mkdir /data/redis/6379/{data,log} -p&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;启动命令&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# ln -s /usr/local/redis/bin/* /usr/bin/# mv /etc/init.d/redis_6379 /etc/init.d/redis&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;启动redis&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# service redis start&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;查看端口&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# netstat -tunpl|grep redis&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;slave服务器配置修改&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# vim /etc/redis/6379.conf&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;在以下位置添加一行&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# slaveof&lt;/span&gt;
&lt;span class="code-line"&gt;slaveof 192.168.1.83 6379&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;重启redis&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# service redis restart&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;查看端口&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# netstat -tunpl|grep redis&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;测试主机数据同步&lt;/h2&gt;
&lt;h4&gt;在master主机写入key&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;[root@localhost redis]# redis-cli&lt;/span&gt;
&lt;span class="code-line"&gt;127.0.0.1:6379&amp;gt; set name zheng&lt;/span&gt;
&lt;span class="code-line"&gt;OK&lt;/span&gt;
&lt;span class="code-line"&gt;127.0.0.1:6379&amp;gt; keys *&lt;/span&gt;
&lt;span class="code-line"&gt;1) &amp;quot;name&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;在slave主机查看key&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;[root@localhost conf]# redis-cli&lt;/span&gt;
&lt;span class="code-line"&gt;127.0.0.1:6379&amp;gt; keys *&lt;/span&gt;
&lt;span class="code-line"&gt;1) &amp;quot;name&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;127.0.0.1:6379&amp;gt;set name zheng   #默认是读写分离的&lt;/span&gt;
&lt;span class="code-line"&gt;(error) READONLY You can&amp;#39;t write against a read only slave.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h6&gt;####主从切换&lt;/h6&gt;
&lt;h4&gt;1.停止master&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;[root@localhost redis]# service redis stop &lt;/span&gt;
&lt;span class="code-line"&gt;Stopping ...&lt;/span&gt;
&lt;span class="code-line"&gt;Redis stopped&lt;/span&gt;
&lt;span class="code-line"&gt;[root@localhost redis]# redis-cli &lt;/span&gt;
&lt;span class="code-line"&gt;Could not connect to Redis at 127.0.0.1:6379: Connection refused&lt;/span&gt;
&lt;span class="code-line"&gt;not connected&amp;gt; &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;2.将从redis设成主redis&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;[root@localhost ~]# redis-cli -p 6379 slaveof NO ONE &lt;/span&gt;
&lt;span class="code-line"&gt;OK&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;3.测试从redis是否切换从主redis&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;[root@localhost ~]# redis-cli &lt;/span&gt;
&lt;span class="code-line"&gt;127.0.0.1:6379&amp;gt; set name zhengfuqiang&lt;/span&gt;
&lt;span class="code-line"&gt;OK&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;原来的主redis恢复正常了，要重新切换回去&lt;/p&gt;
&lt;h4&gt;1.将现在的主redis的数据进行保存&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;[root@localhost ~]# redis-cli &lt;/span&gt;
&lt;span class="code-line"&gt;127.0.0.1:6379&amp;gt; set name zhengfuqiang&lt;/span&gt;
&lt;span class="code-line"&gt;OK&lt;/span&gt;
&lt;span class="code-line"&gt;127.0.0.1:6379&amp;gt; set age 24&lt;/span&gt;
&lt;span class="code-line"&gt;OK&lt;/span&gt;
&lt;span class="code-line"&gt;127.0.0.1:6379&amp;gt; set email zheng@qq.com&lt;/span&gt;
&lt;span class="code-line"&gt;OK&lt;/span&gt;
&lt;span class="code-line"&gt;127.0.0.1:6379&amp;gt; save&lt;/span&gt;
&lt;span class="code-line"&gt;OK&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;2.将现在的主redis根目录下dump.rdb文件拷贝覆盖到原来主redis的根目录&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;# scp /data/redis/6379/data/dump.rdb root@192.168.1.83:/data/redis/6379/data/&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;启动原来的master&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;[root@localhost data]# service redis start&lt;/span&gt;
&lt;span class="code-line"&gt;Starting Redis server...&lt;/span&gt;
&lt;span class="code-line"&gt;[root@localhost data]# redis-cli&lt;/span&gt;
&lt;span class="code-line"&gt;127.0.0.1:6379&amp;gt;  keys *&lt;/span&gt;
&lt;span class="code-line"&gt;1) &amp;quot;pass&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;2) &amp;quot;name&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;3) &amp;quot;age&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;127.0.0.1:6379&amp;gt; &lt;/span&gt;
&lt;span class="code-line"&gt;[root@localhost data]# redis-cli slaveof 192.168.1.83 6379#在slave切换&lt;/span&gt;
&lt;span class="code-line"&gt;OK&lt;/span&gt;
&lt;span class="code-line"&gt;[root@localhost data]# redis-cli&lt;/span&gt;
&lt;span class="code-line"&gt;127.0.0.1:6379&amp;gt;  keys *&lt;/span&gt;
&lt;span class="code-line"&gt;1) &amp;quot;name&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;2) &amp;quot;pass&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;3) &amp;quot;age&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;4) &amp;quot;email&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="nosql"></category><category term="redis"></category></entry><entry><title>yum安装PHP+Nginx+Mysql</title><link href="http://www.opdev.cn/linux/yum-nginx-php-mysql.html" rel="alternate"></link><published>2014-05-27T21:41:39+08:00</published><updated>2014-05-27T21:41:39+08:00</updated><author><name>zheng</name></author><id>tag:www.opdev.cn,2014-05-27:/linux/yum-nginx-php-mysql.html</id><summary type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;环境:Contos6.4 32位&lt;/span&gt;
&lt;span class="code-line"&gt;配置：2核+512memory+30disk&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Step1：安装Yum源&lt;/h2&gt;
&lt;p&gt;因为nginx和php-fpm都不能直接通过Yum直接安装，所以我们需要下载两个仓库到我们的VPS上。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# rpm -Uvh http://download.fedoraproject.org/pub/epel …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;环境:Contos6.4 32位&lt;/span&gt;
&lt;span class="code-line"&gt;配置：2核+512memory+30disk&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Step1：安装Yum源&lt;/h2&gt;
&lt;p&gt;因为nginx和php-fpm都不能直接通过Yum直接安装，所以我们需要下载两个仓库到我们的VPS上。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# rpm -Uvh http://download.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm&lt;/span&gt;
&lt;span class="code-line"&gt;# rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;报错1：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Error&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Cannot&lt;/span&gt; &lt;span class="n"&gt;retrieve&lt;/span&gt; &lt;span class="n"&gt;metalink&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;repository&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;epel&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;Please&lt;/span&gt; &lt;span class="n"&gt;verify&lt;/span&gt; &lt;span class="n"&gt;its&lt;/span&gt; &lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="n"&gt;and&lt;/span&gt; &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="n"&gt;again&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;处理很简单，修改文件“/etc/yum.repos.d/epel.repo”，将baseurl的注释取消，mirrorlist注释掉。即可。&lt;/p&gt;
&lt;p&gt;报错2：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# yum [Errno 256] No more mirrors to try 解决方法&lt;/span&gt;
&lt;span class="code-line"&gt;# yum clean all&lt;/span&gt;
&lt;span class="code-line"&gt;# yum makecache&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Step2：安装Mysql&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# yum install mysql mysql-server&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;安装完毕后，重启Mysql&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# /etc/init.d/mysqld restart&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;重启完后，我们可以启动Mysql的安全配置项&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# /usr/bin/mysql_secure_installation&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Step3：安装nginx&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# yum install nginx&lt;/span&gt;
&lt;span class="code-line"&gt;# /etc/init.d/nginx start&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在浏览器上直接输入ip地址测试&lt;/p&gt;
&lt;p&gt;通过运行下面的命令来显示你服务器的ip地址。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;ifconfig eth0 | grep inet | awk &amp;#39;{ print $2 }&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Step4：安装php&lt;/h2&gt;
&lt;p&gt;因为php包是在REMI仓库中的，并且目前是被禁用的。我们首先要做的就是启用REMI仓库并且安装php和php-fpm还有php-mcrypt（phpmyadmin需要php-mcrypt和php-mbstring扩展，不安装可能会在启动phpmyadmin时候导致模块缺失的错误。你还可以选择安装其他所需要的扩展，已经在下面列出）。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# yum --enablerepo=remi,remi-php55 install php-fpm php-mysql php-mcrypt php-mbstring&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;更多扩展项如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;yum --enablerepo=remi,remi-php55 install php-cli php-gd php-pear php-mysqlnd php-pdo php-pgsql php-pecl-mongo php-sqlite php-pecl-memcached php-pecl-memcache php-mbstrin php-xml php-soap php-mcrypt php-fpm&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Step5：配置nginx&lt;/h2&gt;
&lt;p&gt;打开默认的nginx配置文件&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# vi /etc/nginx/nginx.conf&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;将workerprocesses的数字提升到2，保存并退出。&lt;/p&gt;
&lt;p&gt;现在来配置nginx的虚拟主机。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# vi /etc/nginx/conf.d/default.conf&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;相关配置和配置改动（在配置的下面）如下。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="err"&gt;listen&lt;/span&gt; &lt;span class="err"&gt;80&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="err"&gt;server_name&lt;/span&gt; &lt;span class="err"&gt;example.com&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="err"&gt;location&lt;/span&gt; &lt;span class="err"&gt;/&lt;/span&gt; &lt;span class="err"&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;         &lt;span class="err"&gt;root&lt;/span&gt; &lt;span class="err"&gt;/usr/share/nginx/html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;         &lt;span class="err"&gt;index&lt;/span&gt; &lt;span class="err"&gt;index.php&lt;/span&gt; &lt;span class="err"&gt;index.html&lt;/span&gt; &lt;span class="err"&gt;index.htm&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nt"&gt;error_page&lt;/span&gt; &lt;span class="nt"&gt;404&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;404&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;html&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nt"&gt;location&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;404&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;html&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="err"&gt;root&lt;/span&gt; &lt;span class="err"&gt;/usr/share/nginx/html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nt"&gt;error_page&lt;/span&gt; &lt;span class="nt"&gt;500&lt;/span&gt; &lt;span class="nt"&gt;502&lt;/span&gt; &lt;span class="nt"&gt;503&lt;/span&gt; &lt;span class="nt"&gt;504&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;50x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;html&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nt"&gt;location&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;50x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;html&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="err"&gt;root&lt;/span&gt; &lt;span class="err"&gt;/usr/share/nginx/html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="nt"&gt;pass&lt;/span&gt; &lt;span class="nt"&gt;the&lt;/span&gt; &lt;span class="nt"&gt;PHP&lt;/span&gt; &lt;span class="nt"&gt;scripts&lt;/span&gt; &lt;span class="nt"&gt;to&lt;/span&gt; &lt;span class="nt"&gt;FastCGI&lt;/span&gt; &lt;span class="nt"&gt;server&lt;/span&gt; &lt;span class="nt"&gt;listening&lt;/span&gt; &lt;span class="nt"&gt;on&lt;/span&gt; &lt;span class="nt"&gt;127&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;0&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;0&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;9000&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="err"&gt;#&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nt"&gt;location&lt;/span&gt; &lt;span class="o"&gt;~&lt;/span&gt; &lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;php&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="err"&gt;root&lt;/span&gt; &lt;span class="err"&gt;/usr/share/nginx/html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="err"&gt;fastcgi_pass&lt;/span&gt; &lt;span class="err"&gt;127.0.0.1:9000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="err"&gt;fastcgi_index&lt;/span&gt; &lt;span class="err"&gt;index.php&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="err"&gt;fastcgi_param&lt;/span&gt; &lt;span class="err"&gt;SCRIPT_FILENAME&lt;/span&gt; &lt;span class="err"&gt;$document_root$fastcgi_script_name&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="err"&gt;include&lt;/span&gt; &lt;span class="err"&gt;fastcgi_params&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;删除/etc/nginx/conf.d/目录下不用的配置&lt;/p&gt;
&lt;h2&gt;Step6：配置php-fpm&lt;/h2&gt;
&lt;p&gt;打开php-fpm配置&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# vi /etc/php-fpm.d/www.conf&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在用户和组中，用nginx代替apache&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;user = nginx&lt;/span&gt;
&lt;span class="code-line"&gt;group = nginx&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;保存并重启php-fpm。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# service php-fpm restart&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Setp7：创建phpinfo测试&lt;/h2&gt;
&lt;p&gt;首先我们创建一个新的文件。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# vi /usr/share/nginx/html/info.php&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt; &lt;span class="nb"&gt;phpinfo&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt; &lt;span class="cp"&gt;?&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;保存并退出。&lt;/p&gt;
&lt;p&gt;重启nginx，使配置生效。（注：将来对配置进行任何更改后，都要重启，配置才会生效。）&lt;/p&gt;
&lt;p&gt;访问你在配置中输入的域名或者ip地址对应的phpinfo页面。&lt;a href="http://ip/info.php"&gt;http://IP/info.php&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Step8：设置自启动。&lt;/h2&gt;
&lt;p&gt;最后一步就是将刚刚装的所有程序设置自启动。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;# chkconfig --levels 235 mysqld on&lt;/span&gt;
&lt;span class="code-line"&gt;# chkconfig --levels 235 nginx on&lt;/span&gt;
&lt;span class="code-line"&gt;# chkconfig --levels 235 php-fpm on&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;恭喜，你已经完成了配置部分&lt;/p&gt;</content><category term="Linux"></category><category term="nginx"></category><category term="mysql"></category></entry><entry><title>mail命令发送邮件中文乱码或附件为tcmime.*.bin</title><link href="http://www.opdev.cn/linux/linux-mail.html" rel="alternate"></link><published>2014-05-15T21:57:53+08:00</published><updated>2014-05-15T21:57:53+08:00</updated><author><name>zheng</name></author><id>tag:www.opdev.cn,2014-05-15:/linux/linux-mail.html</id><summary type="html">&lt;p&gt;由于公司API服务器需要统计用户访问信息，于是编写了shell脚本发送统计信息到邮箱。&lt;/p&gt;
&lt;p&gt;但收到的邮件出现乱码，解决过程记录：&lt;/p&gt;
&lt;h3&gt;现象&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;使用Foxmail客户端收取邮件中文出现乱码，如“报告生成时间???2015-05-14 00:30 总???问???:515076”；&lt;/li&gt;
&lt;li&gt;使用web邮箱收取邮件无内容，只显示附件为tcmime.1101.1101.4747.bin之类的内容 …&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;由于公司API服务器需要统计用户访问信息，于是编写了shell脚本发送统计信息到邮箱。&lt;/p&gt;
&lt;p&gt;但收到的邮件出现乱码，解决过程记录：&lt;/p&gt;
&lt;h3&gt;现象&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;使用Foxmail客户端收取邮件中文出现乱码，如“报告生成时间???2015-05-14 00:30 总???问???:515076”；&lt;/li&gt;
&lt;li&gt;使用web邮箱收取邮件无内容，只显示附件为tcmime.1101.1101.4747.bin之类的内容；&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;分析&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;检查脚本文件编码是否为utf-8（可vi进去后，:set fileencoding查看）;&lt;/li&gt;
&lt;li&gt;检测系统环境是否安装了中文包支持（使用 locale命令）；&lt;/li&gt;
&lt;li&gt;检查shell命令行和crond环境变量是否一致（使用env查看）&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;解决&lt;/h3&gt;
&lt;p&gt;我这里的中文乱码原因是因为shell命令行和crond环境变量不一致导致，脚本中加入export LANG=en_US.UTF-8&lt;/p&gt;</content><category term="Python"></category><category term="Linux"></category><category term="报错"></category></entry></feed>